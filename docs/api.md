# **ZsiBot SDK API Definition** 

## 1. App 控制接口函数介绍
    

**class AppFunc**

- 该类包含控制机器狗应用功能的方法，用户可以使用这些方法来进行上层控制和获取数据。

### 1.1. 创建连接 -> initRobot

|函数名|initRobot(std::string & local_ip, int local_port, string& dog_ip = "192.168.234.1")|
|:---:|:---|
|功能概述|与机器狗建立通信,机器狗端ip默认“192.168.234.1”, 如更改机器人ip，需从该接口传入新ip|
|参数|local_ip:用户主机IP地址,必选项<br> local_port:用户主机端口，必选项<br>dog_ip:机器狗IP地址：可选项|
|返回值|无|
|备注|通信建立失败时，终端输出失败日志|

### 1.2. 检查通讯状态 -> checkConnection
`此接口从v0.2.6版本开始支持`

|函数名|checkConnection()|
|:---:|:---|
|功能概述|检查机器人通讯状态|
|参数|无|
|返回值|类型：bool<br>true:连接正常<br>false:连接失败|
|备注|可做心跳检测|

### 1.3. 站起 -> standUP

|函数名|standUP()|
|:---:|:---|
|功能概述|控制机器狗站立|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|机器狗正常站立，移动中不可直接切入此状态|

### 1.4. 趴下 -> lieDown

|函数名|lieDown()|
|:---:|:---|
|功能概述|控制机器狗站低|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|机器狗站低，关节锁定，移动中不可直接切入此状态|

### 1.5. 阻尼 -> passive

|函数名|passive()|
|:---:|:---|
|功能概述|控制机器狗紧急趴下|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|机器狗进入阻尼状态，趴下|

### 1.6. 移动 -> move

|函数名|move(float vx, float vy, float yaw_rate)|
|:---:|:---|
|功能概述|控制机器狗运动|
|参数|vx:前向速度,必选项，不进行移动则传入0<br>vy:侧向速度,必选项，不进行移动则传入0<br>yaw_rate:绕Z轴角速度,必选项，不进行移动则传入0|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在机器狗站立状态下切入，控制狗按指定速度运动。 <br>vx范围（-3m/s ~ -0.05m/s; 0.05m/s ~ 3m/s）<br>vy 范围（-1.0m/s ~ -0.1m/s;0.1m/s ~ 1.0m/s）<br>yaw_rate范围（-3.0rad/s ~ -0.02rad/s;0.02rad/s ~ 2.0rad/s）|

### 1.7. 原地跳 -> jump

|函数名|jump()|
|:---:|:---|
|功能概述|控制机器狗垂直跳跃|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在站立状态下切入，移动中不可切换状态|

### 1.8. 向前跳 -> frontJump

|函数名|frontJump()|
|:---:|:---|
|功能概述|控制机器狗向前跳|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在站立状态下切入，移动中不可切换状态|

### 1.9. 后空翻 -> backflip

|函数名|backflip()|
|:---:|:---|
|功能概述|控制机器狗后空翻|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在站立状态下切入，移动中不可切换状态|

### 1.10. 打招呼 -> shakeHand
`此接口从v0.2.6版本开始支持`

|函数名|shakeHand()|
|:---:|:---|
|功能概述|控制机器狗打招呼|
|参数|无|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在站立状态下切入，移动中不可切换状态|

### 1.11. 双腿站立 -> twoLegStand
`此接口从v0.2.6版本开始支持`

|函数名|twoLegStand(float vx, float yaw_rate)|
|:---:|:---|
|功能概述|控制机器狗双腿站立|
|参数|vx:前向速度，必选项，不移动则传入0<br>yaw_rate:绕Z轴角速度，必选项，不移动则传入0|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|仅在站立状态下切入，移动中不可切入该状态<br>退出双腿站立状态需调用cancelTwoLegStand(),不响应其他接口<br>通过参数可控制狗按指定速度运动。 <br>vx范围（-0.5~-0.2 / 0.2~0.5m / s）<br>yaw_rate范围（-1~-0.2 / 0.2~1.0 rad / s）|

### 1.12. 退出双腿站立 -> cancelTwoLegStand
`此接口从v0.2.6版本开始支持`

|函数名|cancelTwoLegStand()|
|:---:|:---|
|功能概述|控制机器狗退出双腿站立|
|参数|无|
|返回值|无|
|备注|机器狗退出双腿站立状态，机器狗双腿站立状态下切入|

### 1.13. 姿态控制 -> attitudeControl

|函数名|attitudeControl(float roll_vel, float pitch_vel,float yaw_vel, float height_vel)|
|:---:|:---|
|功能概述|控制机器狗原地扭动和身体高度变化|
|参数|roll_vel: 绕X轴角速度,必选项，不进行控制则传入0<br>pitch_vel: 绕Y轴角速度,必选项，不进行控制则传入0<br>yaw_vel: 绕Z轴角速度,必选项，不进行控制则传入0<br>height_vel: 垂直高度速度,必选项，不进行控制则传入0|
|返回值|类型：uint32_t<br>0:进入状态正常<br>0x3012:电机数据丢失<br>0x3010:电机失能<br>0x3011:电机故障<br>0x3009:电机角度超限<br>0x3007:状态机切换失败<br>0x3013:速度命令过大|
|备注|机器狗站立状态下切入，控制狗按指定速度原地扭动，身体高度变化。<br> yaw_vel, pitch_vel, roll_vel范围（-0.5rad/s~0.5rad/s）height_vel范围（-0.5m/s-0.5m/s）|

### 1.14. 获取机器狗姿态四元数 -> getQuaternion
`此接口从v0.2.6版本开始支持`

|函数名|getQuaternion()|
|:---:|:---|
|功能概述|获取机器狗当前姿态四元数|
|参数|无|
|返回值|包含4个元素的向量[w, x, y, z]，分别对应四元数的四个分量|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.15. 获取机器狗姿态欧拉角 -> getRPY
`此接口从v0.2.6版本开始支持`

|函数名|getRPY()|
|:---:|:---|
|功能概述|获取机器狗当前姿态的欧拉角（滚转角、俯仰角、偏航角）。|
|参数|无|
|返回值|包含 3 个元素的向量[roll, pitch, yaw]，单位为弧度（rad），分别对应绕 X、Y、Z 轴的旋转角|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.16. 获取机器狗加速度 -> getBodyAcc
`此接口从v0.2.6版本开始支持`

|函数名|getBodyAcc()|
|:---:|:---|
|功能概述|获取机器狗身体的加速度数据（机体坐标系）。|
|参数|无|
|返回值|包含 3 个元素的向量[ax, ay, az]，单位为 m/s²，分别对应 X、Y、Z 轴方向的加速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.17. 获取机器狗角速度 -> getBodyGyro
`此接口从v0.2.6版本开始支持`

|函数名|getBodyGyro()|
|:---:|:---|
|功能概述|获取机器狗身体的角速度数据（机体坐标系）。|
|参数|无|
|返回值|包含 3 个元素的向量[gx, gy, gz]，单位为 rad/s，分别对应 X、Y、Z 轴方向的角速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.18. 获取机器狗上电原点坐标系位置 -> getPosition
`此接口从v0.2.6版本开始支持`

|函数名|getPosition()|
|:---:|:---|
|功能概述|获取机器狗在上电原点坐标系中的位置坐标。|
|参数|无|
|返回值|包含 3 个元素的向量[x, y, z]，单位为米（m），表示当前位置。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.19. 获取机器狗上电原点坐标系移动速度 -> getWorldVelocity
`此接口从v0.2.6版本开始支持`

|函数名|getWorldVelocity()|
|:---:|:---|
|功能概述|获取机器狗在上电原点坐标系中的移动速度。|
|参数|无|
|返回值|包含 3 个元素的向量[vx, vy, vz]，单位为米/秒（m/s），分别对应上电原点坐标系 X、Y、Z 轴方向的速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.20. 获取机器狗自身移动速度 -> getBodyVelocity
`此接口从v0.2.6版本开始支持`

|函数名|getBodyVelocity()|
|:---:|:---|
|功能概述|获取机器狗在机体坐标系中的移动速度。|
|参数|无|
|返回值|包含 3 个元素的向量[vx, vy, vz]，单位为 m/s，分别对应机体坐标系 X、Y、Z 轴方向的速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.21. 获取机器狗电量 -> getBatteryPower
`此接口从v0.2.6版本开始支持`

|函数名|getBatteryPower()|
|:---:|:---|
|功能概述|获取机器狗电量|
|参数|无|
|返回值|类型: uint32_t<br>范围: 0-100|
|备注|返回值范围 0-100, 0为无电, 100为满电|

### 1.22. 获取机器狗控制模式 -> getCurrentCtrlmode
`此接口从v0.2.6版本开始支持`

|函数名|getCurrentCtrlmode()|
|:---:|:---|
|功能概述|获取机器狗当前控制模式|
|参数|无|
|返回值|类型：uint32_t<br>0:阻尼模式，设备未使能<br>1:站立状态/打招呼状态<br>18:移动状态<br>21:动作状态(姿态模式、跳跃模式、双腿站立等)<br>51:趴下状态。|
|备注|无|

### 1.23. 获取机器狗Abad关节角度 -> getLegAbadJoint
`此接口从v0.2.6版本开始支持`

|函数名|getLegAbadJoint()|
|:---:|:---|
|功能概述|获取各条腿的髋关节外展 / 内收关节（Abad Joint）的当前角度。|
|参数|无|
|返回值|包含 4 个元素的向量，分别对应右前、左前、右后、左后的 Abad 关节角度（单位：rad）。|
|备注|单位rad， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.24. 获取机器Hip关节角度 -> getLegHipJoint
`此接口从v0.2.6版本开始支持`

|函数名|getLegHipJoint()|
|:---:|:---|
|功能概述|获取各条腿的髋关节俯仰关节（Hip Joint）的当前角度。|
|参数|无|
|返回值|包含 4 个元素的向量，分别对应右前、左前、右后、左后的 Hip 关节角度（单位：rad）。|
|备注|单位rad/s， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.25. 获取机器Knee关节角度 -> getLegKneeJoint
`此接口从v0.2.6版本开始支持`

|函数名|getLegKneeJoint()|
|:---:|:---|
|功能概述|获取各条腿的膝关节（Knee Joint）的当前角度。|
|参数|无|
|返回值|包含 4 个元素的向量，分别对应右前、左前、右后、左后的 Knee 关节角度（单位：rad）。|
|备注|单位rad/s， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.26. 获取机器狗Abad关节的角速度 -> getLegAbadJointVel
`此接口从v0.2.6版本开始支持`

|函数名|getLegAbadJointVel()|
|:---:|:---|
|功能概述|获取各条腿 Abad 关节的当前角速度。|
|参数|无|
|返回值|包含 4 个元素的向量，单位为 rad/s，分别对应右前、左前、右后、左后的关节角度。|
|备注|单位rad/s， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.27. 获取机器狗Hip关节角速度 -> getLegHipJointVel
`此接口从v0.2.6版本开始支持`

|函数名|getLegHipJointVel()|
|:---:|:---|
|功能概述|获取各条腿 Hip 关节的当前角速度。|
|参数|无|
|返回值|包含 4 个元素的向量，单位为 rad/s，分别对应右前、左前、右后、左后的节角度。|
|备注|单位rad/s， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.28. 获取机器狗Knee关节角速度 -> getLegKneeJointVel
`此接口从v0.2.6版本开始支持`

|函数名|getLegKneeJointVel()|
|:---:|:---|
|功能概述|获取各条腿 Knee 关节的当前角速度。|
|参数|无|
|返回值|包含 4 个元素的向量，单位为 rad/s，分别对应右前、左前、右后、左后的关节角度。|
|备注|单位rad/s， 机器狗身体机器狗朝前为X，左侧为Y，垂直向上为Z|

### 1.29. 获取机器狗Abad关节扭矩 -> getLegAbadJointTorque
`此接口从v0.2.6版本开始支持`

|函数名|getLegAbadJointTorque()|
|:---:|:---|
|功能概述|获取各条腿 Abad 关节的当前输出扭矩。|
|参数|无|
|返回值|包含 4 个元素的向量，单位通常为 N・m，对应顺序同关节扭矩。|
|备注|单位通常为 N・m，分别对应右前、左前、右后、左后的 Knee 关节扭矩。|

### 1.30. 获取机器狗相Hip关节扭矩 -> getLegHipJointTorque
`此接口从v0.2.6版本开始支持`

|函数名|getLegHipJointTorque()|
|:---:|:---|
|功能概述|获取各条腿 Hip 关节的当前输出扭矩。|
|参数|无|
|返回值|包含 4 个元素的向量，单位通常为 N・m，对应顺序同关节扭矩。|
|备注|单位通常为 N・m，分别对应右前、左前、右后、左后的 Knee 关节扭矩。|

### 1.31. 获取机器狗Knee关节扭矩 -> getLegKneeJointTorque
`此接口从v0.2.6版本开始支持`

|函数名|getLegKneeJointTorque()|
|:---:|:---|
|功能概述|获取各条腿 Knee 关节的当前输出扭矩。|
|参数|无|
|返回值|包含 4 个元素的向量，单位通常为 N・m，对应顺序同关节扭矩。|
|备注|单位通常为 N・m，分别对应右前、左前、右后、左后的 Knee 关节扭矩。|


## 2. Motor控制接口函数介绍
    

**class MotorFunc**

- 该类用于与电机进行交互，包括发送电机命令和获取电机状态。

### 2.1 创建连接 -> initRobot 

|函数名|initRobot(std::string & local_ip, int local_port, string& dog_ip = "192.168.234.1")|
|:---:|:---|
|功能概述|与机器狗建立通信,机器狗端ip默认“192.168.234.1”, 如更改机器人ip，需从该接口传入新ip|
|参数|local_ip:用户主机IP地址,必选项<br> local_port:用户主机端口，必选项<br>dog_ip:机器狗IP地址：可选项|
|返回值|无|
|备注|通信建立失败时，终端输出失败日志|

### 2.2. 检查通讯状态 -> checkConnection
`此接口从v0.2.6版本开始支持`

|函数名|checkConnection()|
|:---:|:---|
|功能概述|检查机器人通讯状态|
|参数|无|
|返回值|类型：bool<br>true:连接正常<br>false:连接失败|
|备注|可做心跳检测|

### 2.3 发送电机指令 -> sendMotorCmd

|函数名|sendMotorCmd(motorCmd& cmd)|
|:---:|:---|
|功能概述|发布电机控制命令|
|参数|motorCmd|
|返回值|发送成功返回0，失败返回-1|
|备注|腿部顺序： 右前腿为1号腿， 左前腿为2号腿， 右后腿为3号腿， 左后腿为4号腿；控制命令坐标系为机器狗朝前为X，左侧为Y，垂直向上为Z|

- Cmd 数据协议
    

```C++
struct alignas(4) motorCmd  {

  float q_des_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节角度指令
  float q_des_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节角度指令
  float q_des_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节角度指令

  float qd_des_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节角速度指令
  float qd_des_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节角速度指令
  float qd_des_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节角速度指令

  float kp_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节Kp值
  float kp_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节Kp值
  float kp_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节Kp值

  float kd_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节Kd值
  float kd_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节Kd值
  float kd_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节Kd值

  float tau_abad_ff[4] = {0.0, 0.0, 0.0, 0.0}; // A关节扭矩指令
  float tau_hip_ff[4] = {0.0, 0.0, 0.0, 0.0};  // H关节扭矩指令
  float tau_knee_ff[4] = {0.0, 0.0, 0.0, 0.0}; // K关节扭矩指令

};
```


### 2.4. 获取机器狗姿态四元数 -> getQuaternion
`此接口从v0.2.6版本开始支持`

|函数名|getQuaternion()|
|:---:|:---|
|功能概述|获取机器狗当前姿态四元数|
|参数|无|
|返回值|包含4个元素的向量[w, x, y, z]，分别对应四元数的四个分量|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 2.5. 获取机器狗姿态欧拉角 -> getRPY
`此接口从v0.2.6版本开始支持`

|函数名|getRPY()|
|:---:|:---|
|功能概述|获取机器狗当前姿态的欧拉角（滚转角、俯仰角、偏航角）。|
|参数|无|
|返回值|包含 3 个元素的向量[roll, pitch, yaw]，单位为弧度（rad），分别对应绕 X、Y、Z 轴的旋转角|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 2.6. 获取机器狗加速度 -> getBodyAcc
`此接口从v0.2.6版本开始支持`

|函数名|getBodyAcc()|
|:---:|:---|
|功能概述|获取机器狗身体的加速度数据（机体坐标系）。|
|参数|无|
|返回值|包含 3 个元素的向量[ax, ay, az]，单位为 m/s²，分别对应 X、Y、Z 轴方向的加速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|

### 2.7. 获取机器狗角速度 -> getBodyGyro
`此接口从v0.2.6版本开始支持`

|函数名|getBodyGyro()|
|:---:|:---|
|功能概述|获取机器狗身体的角速度数据（机体坐标系）。|
|参数|无|
|返回值|包含 3 个元素的向量[gx, gy, gz]，单位为 rad/s，分别对应 X、Y、Z 轴方向的角速度。|
|备注|机器狗朝前为X，左侧为Y，垂直向上为Z|


### 2.8. 获取机器狗电机数据 -> getMotorState

|函数名|getMotorState()|
|:---:|:---|
|功能概述|获取机器狗电机数据|
|参数|无|
|返回值|返回各电机数据|
|备注|单位rad|

- MotorState 数据协议
    

```C++
struct alignas(4) motorState {
  // 关节顺序 FL,FR,RL,RR
  float q_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节角度
  float q_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节角度
  float q_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节角度


  float qd_abad[4] = {0.0, 0.0, 0.0, 0.0}; // A关节角速度
  float qd_hip[4] = {0.0, 0.0, 0.0, 0.0};  // H关节角速度
  float qd_knee[4] = {0.0, 0.0, 0.0, 0.0}; // K关节角速度


  float tau_abad_fb[4] = {0.0, 0.0, 0.0, 0.0};// A关节扭矩反馈
  float tau_hip_fb[4] = {0.0, 0.0, 0.0, 0.0};  // H关节扭矩反馈
  float tau_knee_fb[4] = {0.0, 0.0, 0.0, 0.0}; // K关节扭矩反馈
};
```

### 2.9 电机是否存在数据 -> haveMotorData

|函数名|haveMotorData()|
|:---:|:---|
|功能概述|判断是否获取到电机数据|
|参数|无|
|返回值|返回true or false|
|备注|在下发电机命令之前先判断是否收到电机数据|